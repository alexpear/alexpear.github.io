<body style="background: #236A89; color: #FFFFFF; font-size: 24px"> 

  <!-- TODO wnode.js calls require(), which isnt supported here. Use a stripped-down WNode class for now? -->
  <script type="text/javascript" src="../wnode/wnode.js"></script>

  <script type="text/javascript">
    let currentNode;
    const domStuff = getDomElements();

    // alert('script is running');
    init();

    // TODO consider whether to have these funcs be static funcs of a TreeBrowser class, or similar.
    function init (root) {
      // alert('init is running');

      currentNode = root || exampleRoot();
      currentNode.parent = undefined;
      updateUi(currentNode);
    }

    function getDomElements () {
      return {
        parentButton: document.getElementById('parentButton'),
        currentNodeName: document.getElementById('currentNodeName'),
        discardButton: document.getElementById('discardButton'),
        propertiesDiv: document.getElementById('properties'),
        componentsDiv: document.getElementById('components')
      };
    }

    function exampleRoot () {
      const li = new WNode('adacemyStudent');
      li.add(new WNode('smg'));
      li.add(new WNode('helmet'));

      const wren = new WNode('academyStudent');
      wren.add(new WNode('gladius'));
      wren.add(new WNode('combatShield'));

      const squad = new WNode('infantrySquad');
      squad.add(li, wren);

      return squad;
    }

    function loadFile (todo) {

    }

    function updateUi (newNode) {
      if (newNode) {
        // Update parent button
        if (newNode.parent) {
          domStuff.parentButton.value = newNode.parent.toString();
        }
        else {
          domStuff.parentButton.value = '(No parent)';
        }

        // Update current node
        domStuff.currentNodeName.innerHTML = newNode.toString();

        // Update component buttons
        updateComponentButtons(newNode);
      }
    }

    function updateComponentButtons (newNode) {
      clearDiv(domStuff.componentsDiv);

      newNode.components.forEach((component, index) => {
        const button = document.createElement('input');
        button.setAttribute('type', 'button');
        button.setAttribute('id', component.id);
        button.classList.add('iconButton');

        domStuff.componentsDiv.appendChild(button);

        button.onclick = 'goToChild(this.id)';
      });
    }

    function clearDiv (div) {
      while(div.firstChild) {
        div.removeChild(div.firstChild);
      }
    }

    function goToNode (newNode) {
      currentNode = newNode;
      updateUi(newNode);
    }

    function goUp () {
      if (! currentNode.parent) {
        // TODO: Friendlier notification.
        return alert('This node has no parent.');
      }

      goToNode(currentNode.parent);
    }

    function goToChild (childId) {
      const child = currentNode.components.find(component => component.id === childId);

      if (! child) {
        // TODO: Friendlier notification.
        return alert(`Error: Could not find a child component with id ${ childId }. The number of child components is ${ currentNode.components.length }.`);
      }

      goToNode(child);
    }

    function discard () {
      // TODO
      updateUi();
    }
  </script>

  <style>
    .center * {
      display: block;
      margin: 0 auto 0 auto;
    }

    .center h3 {
      text-align: center;
    }
  </style>

  <div id="navigatorWindow">

    <h3 id="uiTitle">Tree Navigator</h3>

    <p>Parent: </p>
    <input id="parentButton" type="button" class="iconButton group" onclick="goUp()" value="Newt Squad - Squad">
    <br>

    <input id="discardButton" type="button" onclick="discard()" value="Discard this!">
    <br>

    <h4 id="currentNodeName">Suzy - Academy Student</h4>
    <div id="properties">
      <h4 class="property">Toughness: 8</h4>
      <h4 class="property">Charisma: 4</h4>
    </div>

    <div id="components">
<!--       These will be created by JS: -->
<!--       TODO these should ideally have the ids of their node ids -->
      <input type="button" class="iconButton item" onclick="goToChild(0)" value="Smg">
      <br>
      <input type="button" class="iconButton item" onclick="goToChild(1)" value="Helmet">
      <br>
      <input type="button" class="iconButton item" onclick="goToChild(2)" value="Walkie Talkie">
      <br>
    </div>

  </div>

</body>
